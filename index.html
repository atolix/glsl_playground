<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>GLSL Playground</title>

  <!-- PWA related settings -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">

  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.3/codemirror.min.css">
  <!-- Dracula theme removed as we're using custom GitHub Dark theme -->

  <!-- Custom CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- CodeMirror JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.3/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.3/mode/clike/clike.min.js"></script>
</head>
<body>
  <div class="container">
    <div id="glCanvas"></div>
    <div class="control-panel" id="controlPanel">
      <div id="codeContainer" class="code-container">
        <div id="fragmentShader" class="tab-content active">
          <textarea id="fragmentCode">// This shader automatically adapts to WebGL1/WebGL2
// For WebGL2, #version 300 es will be automatically added at the beginning

// Shader variables
uniform vec2 u_resolution;
uniform float u_time;

// Output variable for WebGL2
// In WebGL2, out vec4 outColor; is used
// In WebGL1, gl_FragColor is used
out vec4 outColor;

// Simple random function
float random(vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

// Simple noise function
float noise(vec2 st) {
    vec2 i = floor(st);
    vec2 f = fract(st);

    // Four corners in 2D of a tile
    float a = random(i);
    float b = random(i + vec2(1.0, 0.0));
    float c = random(i + vec2(0.0, 1.0));
    float d = random(i + vec2(1.0, 1.0));

    // Smooth interpolation
    vec2 u = f * f * (3.0 - 2.0 * f);

    // Mix 4 corners
    return mix(a, b, u.x) +
            (c - a)* u.y * (1.0 - u.x) +
            (d - b) * u.x * u.y;
}

// Simplified FBM
float fbm(vec2 st) {
    float value = 0.0;
    float amplitude = 0.5;
    float frequency = 1.0;

    // Add octaves
    for (int i = 0; i < 5; i++) {
        value += amplitude * noise(st * frequency);
        frequency *= 2.0;
        amplitude *= 0.5;
    }

    return value;
}

void main() {
    // Normalized coordinates
    vec2 uv = gl_FragCoord.xy / u_resolution.xy;

    // Adjust aspect ratio
    uv.x *= u_resolution.x / u_resolution.y;

    // Create faster movement
    vec2 moving_uv = uv + vec2(sin(u_time * 0.25) * 0.1, cos(u_time * 0.3) * 0.1);

    // Generate noise patterns with faster movement
    float n1 = fbm(moving_uv * 3.0 + u_time * 0.1);
    float n2 = fbm(moving_uv * 5.0 + n1 * 2.0 + u_time * 0.05);

    // Create cool color palette
    vec3 color1 = vec3(0.1, 0.3, 0.9);   // Deep blue
    vec3 color2 = vec3(0.2, 0.7, 0.9);   // Cyan/Light blue
    vec3 color3 = vec3(0.4, 0.2, 0.8);   // Purple

    // Mix colors based on noise
    vec3 color = mix(vec3(0.1, 0.1, 0.3), color1, n1);
    color = mix(color, color2, n2);

    // Simple gradient from bottom to top
    float gradient = smoothstep(0.0, 1.0, uv.y);
    color = mix(color, color3, gradient * 0.7);

    // Add faster wave effect
    float wave = sin(uv.x * 15.0 + u_time * 2.0) * 0.03;
    color += wave * vec3(0.0, 0.5, 1.0);

    // Faster pulsing effect
    float pulse = 1.0 + 0.1 * sin(u_time * 0.8);
    color *= pulse;

    // Output color
    outColor = vec4(color, 1.0);
}
          </textarea>
        </div>
      </div>
      <div class="buttons">
        <button onclick="toggleShader()">Play</button>
        <button onclick="toggleCode()">Hide Editor</button>
      </div>
    </div>
  </div>

  <!-- Custom JavaScript -->
  <script src="script.js"></script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js').then(function(registration) {
          console.log('ServiceWorker registration successful: ', registration.scope);
        }, function(err) {
          console.log('ServiceWorker registration failed: ', err);
        });
      });
    }
  </script>
</body>
</html>
